<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>BCTI - Advanced Exam Maker (Smart Counter & Option Control)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <style>
        :root { --primary: #1a237e; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 450px; background: #fff; border-right: 2px solid #ddd; display: flex; flex-direction: column; }
        .tab-btn-group { display: flex; background: #eee; }
        .tab-btn { flex: 1; padding: 12px; border: none; cursor: pointer; font-weight: bold; background: #eee; font-size: 13px; }
        .tab-btn.active { background: #fff; border-bottom: 2px solid var(--primary); color: var(--primary); }
        .panel { padding: 15px; flex: 1; overflow-y: auto; display: none; box-sizing: border-box; }
        .panel.active { display: block; }
        .admin-only { display: none; }
        .admin-active .admin-only { display: block; }
        .input-group { margin-bottom: 10px; }
        .input-group label { display: block; font-weight: bold; margin-bottom: 4px; font-size: 13px; }
        .input-group input, textarea, select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        
        .preview-area { 
            flex: 1; 
            background: #ffffff !important; /* ‚úÖ ‡¶™‡ßÅ‡¶∞‡ßã ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶∏‡¶æ‡¶¶‡¶æ */
            display: flex; 
            justify-content: center; 
            padding: 20px; 
            overflow-y: auto; 
        }
        .exam-paper { 
            width: 210mm; 
            min-height: 297mm; 
            background: white; 
            box-sizing: border-box; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1); /* ‚úÖ ‡¶π‡¶æ‡¶≤‡¶ï‡¶æ ‡¶∂‡ßç‡¶Ø‡¶æ‡¶°‡ßã */
            position: relative; 
        }
        
        .header { text-align: center; margin-bottom: 5px; padding-bottom: 5px; }
        .header h1 { margin: 0; font-weight: bold; line-height: 1.3; }
        .header h2 { margin: 0; font-weight: bold; line-height: 1.3; }
        
        .header-info { margin: 0; font-weight: bold; text-align: center; display: block; line-height: 1.3; }
        #outSubjectLine { padding-bottom: 4px; margin-bottom: 8px; text-align: center; }

        .smart-counter-dashboard { background: var(--primary); color: white; padding: 12px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .counter-stats { display: flex; justify-content: space-around; align-items: center; text-align: center; }
        .stat-item h4 { margin: 0; font-size: 10px; text-transform: uppercase; opacity: 0.8; }
        .stat-item .val { font-size: 24px; font-weight: bold; display: block; }
        .stat-item input { width: 50px; background: rgba(255,255,255,0.2); border: 1px solid white; color: white; text-align: center; border-radius: 4px; font-size: 18px; font-weight: bold; }
        .progress-line { width: 100%; background: rgba(255,255,255,0.1); height: 6px; border-radius: 10px; margin-top: 10px; overflow: hidden; }
        #fillBar { width: 0%; height: 100%; background: #4caf50; transition: 0.4s; }

        .restriction-box { background: #e8f5e9; border: 1px solid #c8e6c9; padding: 12px; border-radius: 8px; margin-bottom: 15px; }
        .restriction-box h4 { margin: 0 0 5px 0; color: #2e7d32; font-size: 14px; }
        .restriction-box input { border: 1px solid #a5d6a7 !important; background: #fff !important; }

        #outSetLine { position: absolute; top: 15px; right: 15px; border: 2px solid #000; padding: 3px 10px; font-weight: bold; font-size: 16px; display: none; }
        .marks-info { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 4px; border-bottom: 1px solid #ddd; padding-bottom: 2px; font-size: 13px; }
        .instruction { text-align: center; font-style: italic; font-weight: bold; margin-bottom: 10px; text-decoration: underline; font-size: 13px; }
        .question-container { column-gap: 35px; margin-top: 15px; column-rule: 1px solid #000; }
        .cq-box, .normal-q { break-inside: avoid; margin-bottom: 12px; display: block; }
        .sub-q { display: flex; justify-content: space-between; margin-bottom: 3px; font-size: 12px; }
        .mcq-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-top: 4px; padding-left: 18px; font-size: 12px; }
        #ansSheetArea { margin-top: 25px; border-top: 2px dashed #333; padding-top: 15px; break-before: page; }
        .ans-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px; }
        .ans-box { border: 1px solid #ccc; padding: 5px; font-size: 13px; border-radius: 3px; }
        .btn-action { border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 5px; }
        .btn-mini { padding: 4px 10px; border: none; border-radius: 3px; color: white; cursor: pointer; font-size: 11px; margin-right: 5px; }
        .lock-status { padding: 10px; background: #1a237e; color: white; display: flex; justify-content: space-between; align-items: center; font-size: 13px; }
        
        .q-card { 
            transition: 0.2s; 
            border: 1px solid #eee; 
            margin-bottom: 8px; 
            border-radius: 8px; 
            cursor: pointer; 
            background: #fff; 
            padding: 10px; 
            width: 100%; 
            box-sizing: border-box; 
            overflow-wrap: break-word;
            text-align: left !important; /* ‚úÖ ‡¶¨‡¶æ‡¶Æ ‡¶è‡¶≤‡¶æ‡¶á‡¶®‡¶Æ‡ßá‡¶®‡ßç‡¶ü */
        }
        .q-card:hover { background: #f9f9f9 !important; }
        .q-card-body { 
            white-space: pre-wrap; 
            font-size: 13px; 
            color: #333; 
            margin: 8px 0; 
            line-height: 1.4; 
            word-break: break-word;
            text-align: left !important; /* ‚úÖ ‡¶¨‡¶æ‡¶Æ ‡¶è‡¶≤‡¶æ‡¶á‡¶®‡¶Æ‡ßá‡¶®‡ßç‡¶ü */
        }
        
        .q-card-options { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 4px; 
            font-size: 11px; 
            color: #555; 
            background: #f1f8e9; 
            padding: 6px; 
            border-radius: 4px; 
            margin-top: 5px; 
            border: 1px solid #dcedc8; 
            box-sizing: border-box;
            text-align: left !important; /* ‚úÖ ‡¶¨‡¶æ‡¶Æ ‡¶è‡¶≤‡¶æ‡¶á‡¶®‡¶Æ‡ßá‡¶®‡ßç‡¶ü */
        }
        .q-card-options div { 
            word-break: break-all;
            text-align: left !important; /* ‚úÖ ‡¶¨‡¶æ‡¶Æ ‡¶è‡¶≤‡¶æ‡¶á‡¶®‡¶Æ‡ßá‡¶®‡ßç‡¶ü */
        }

        .board-tag { color: #d32f2f; font-weight: bold; font-size: 11px; margin-left: 5px; }
        .magic-tools { background: #e3f2fd; padding: 10px; border-radius: 5px; margin-bottom: 10px; border: 1px solid #bbdefb; }
        #cropperModal { display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
        .modal-content { background: #fff; width: 90%; max-width: 600px; margin: 50px auto; padding: 20px; border-radius: 8px; text-align: center; }
        #cropImageWrap { max-height: 400px; margin-bottom: 20px; overflow: hidden; }
        #cropImageWrap img { max-width: 100%; }
        
        /* ================== PAGINATION STYLES ================== */
        .selection-pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .selection-pagination button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            min-width: 80px;
        }
        .selection-pagination button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .selection-page-info {
            font-weight: bold;
            color: var(--primary);
            font-size: 14px;
        }
        
        .output-pagination {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            border: 2px solid var(--primary);
        }
        .page-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            min-width: 80px;
        }
        .page-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .page-info {
            font-weight: bold;
            color: var(--primary);
            font-size: 16px;
            min-width: 120px;
            text-align: center;
        }
        .page-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f0f0f0;
            padding: 5px 15px;
            border-radius: 20px;
        }
        .page-input-group input {
            width: 50px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 4px;
        }
        
        .output-page {
            display: none;
            width: 100%;
            min-height: 297mm;
            box-sizing: border-box;
            position: relative;
            page-break-after: always;
            background: white !important; /* ‚úÖ ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü ‡¶™‡ßá‡¶ú‡ßá‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶∏‡¶æ‡¶¶‡¶æ */
        }
        .output-page.active {
            display: block;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 10px;
            border-bottom: 2px solid #000;
            padding-bottom: 8px;
        }
        
        .page-number {
            position: absolute;
            bottom: 10px;
            right: 20px;
            font-size: 11px;
            color: #666;
        }
        
        .pagination-settings {
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        
        .auto-page-indicator {
            display: inline-block;
            background: #4caf50;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            margin-left: 10px;
        }
        
        /* Smart auto-pagination indicator */
        .page-status-indicator {
            background: #1976d2;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
            font-weight: bold;
        }
        /* ================== END PAGINATION STYLES ================== */
        
        /* Slider Styles */
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }
        
        .slider-container input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider-container input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .slider-value {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            color: var(--primary);
            font-size: 13px;
        }
        
        /* Active slider highlight */
        input[type="range"]:active {
            background: #d0d0d0;
        }
        
        input[type="range"]:active::-webkit-slider-thumb {
            background: #0d1b6b;
            transform: scale(1.1);
        }
        
        /* Slider labels */
        .slider-label {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #666;
            margin-top: 3px;
        }
        
        /* Second page header styles */
        .second-page-header {
            display: none;
        }
        
        /* ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .chapter-header {
            background: #e8eaf6;
            color: var(--primary);
            padding: 8px 12px;
            border-radius: 6px;
            margin: 15px 0 10px 0;
            border-left: 4px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-align: left !important; /* ‚úÖ ‡¶¨‡¶æ‡¶Æ ‡¶è‡¶≤‡¶æ‡¶á‡¶®‡¶Æ‡ßá‡¶®‡ßç‡¶ü */
        }

        .chapter-header strong {
            font-size: 14px;
            display: block;
        }

        .chapter-header small {
            font-size: 11px;
            color: #666;
        }

        /* ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶∏‡¶ø‡¶∞‡¶ø‡ßü‡¶æ‡¶≤ ‡¶¨‡ßÉ‡¶§‡ßç‡¶§ */
        .chapter-serial-circle {
            background: var(--primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 13px;
            flex-shrink: 0;
        }
        
        @media print { 
            body {
                background: white !important; /* ‚úÖ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶™‡ßÅ‡¶∞‡ßã ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶∏‡¶æ‡¶¶‡¶æ */
            }
            .sidebar { display: none; } 
            .preview-area { 
                padding: 0; 
                background: white !important; /* ‚úÖ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶∏‡¶Æ‡ßü ‡¶™‡ßÅ‡¶∞‡ßã ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶∏‡¶æ‡¶¶‡¶æ */
                overflow: visible; 
            } 
            .exam-paper { 
                box-shadow: none !important; 
                width: 100%; 
                border: none; 
                margin: 0;
                overflow: visible;
                background: white !important;
            } 
            @page { 
                size: A4; 
                margin: 6mm 6mm 6mm 6mm;
            } 
            .question-container { column-rule: 1px solid #000; column-gap: 30px; } 
            #ansSheetArea.hidden-print { display: none !important; } 
            #outSetLine { display: block !important; border: 2px solid #000 !important; } 
            .output-pagination { display: none !important; }
            .output-page { 
                display: block !important; 
                min-height: 0;
                height: auto;
                page-break-after: always;
                margin: 0;
                padding: 0;
                background: white !important;
            }
            .output-page:last-child { page-break-after: auto; }
            .page-number { display: block !important; }
            /* Prevent questions from breaking across pages */
            .cq-box, .normal-q {
                page-break-inside: avoid;
                break-inside: avoid;
            }
            /* Print optimization */
            .header h1 { font-size: 22px !important; }
            .header h2 { font-size: 18px !important; }
            .header-info { font-size: 14px !important; }
            .marks-info { font-size: 13px !important; }
            .instruction { font-size: 12px !important; }
            .cq-box, .normal-q { margin-bottom: 10px !important; }
            .sub-q { font-size: 11px !important; }
            .mcq-grid { font-size: 11px !important; }
            /* Hide header on second page and beyond */
            .output-page:not(:first-child) .header,
            .output-page:not(:first-child) .header-info,
            .output-page:not(:first-child) #outSubjectLine,
            .output-page:not(:first-child) .marks-info,
            .output-page:not(:first-child) .instruction,
            .output-page:not(:first-child) #outSetLine {
                display: none !important;
            }
            /* Show only page number on subsequent pages */
            .output-page:not(:first-child) {
                padding-top: 5mm !important;
            }
            /* Remove border from subject line in print mode */
            #outSubjectLine { 
                padding-bottom: 4px; 
                margin-bottom: 8px; 
                text-align: center; 
            }
            /* ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞‡ßá‡¶∞ ‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶∏‡ßç‡¶™‡ßá‡¶∏ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü‡ßá‡¶ì ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶® */
            .question-container {
                margin-top: 15px !important;
            }
        }
        
        /* Auto page break hint for print preview */
        .print-page-break {
            display: none;
            text-align: center;
            color: #f44336;
            font-weight: bold;
            padding: 3px;
            margin: 5px 0;
            border-top: 2px dashed #f44336;
            font-size: 11px;
        }
        
        .print-preview-mode .print-page-break {
            display: block;
        }
    </style>
</head>
<body onload="checkLicense()">

<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

<div id="cropperModal">
    <div class="modal-content">
        <h3>‡¶õ‡¶¨‡¶ø ‡¶ï‡ßç‡¶∞‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
        <div id="cropImageWrap"><img id="cropImage" src=""></div>
        <button class="btn-action" style="background:var(--primary); color:white; width:auto; padding:10px 30px;" onclick="finishCrop()">‡¶ï‡ßç‡¶∞‡¶™ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <button class="btn-action" style="background:#777; color:white; width:auto; padding:10px 30px;" onclick="closeCropper()">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
    </div>
</div>

<div class="sidebar" id="sidebarMain">
    <div class="lock-status">
        <span id="lockText">üîí ‡¶Æ‡ßã‡¶°: <b id="currentModeDisplay">‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£</b></span>
        <label style="cursor: pointer;"><input type="checkbox" id="adminToggle" onchange="toggleAdmin()"> ‡¶è‡¶°‡¶Æ‡¶ø‡¶®</label>
    </div>

    <div class="tab-btn-group">
        <button class="tab-btn active" onclick="openTab('select')">‡¶¨‡¶æ‡¶õ‡¶æ‡¶á</button>
        <button class="tab-btn" onclick="openTab('bank')">‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï</button>
        <button class="tab-btn" onclick="openTab('sets')">‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</button>
    </div>

    <div id="select" class="panel active">
        <div class="smart-counter-dashboard">
            <div class="counter-stats">
                <div class="stat-item"><h4>‡¶≤‡¶æ‡¶ó‡¶¨‡ßá</h4><input type="number" id="targetCount" value="10" oninput="updateCounter()"></div>
                <div style="width: 1px; height: 35px; background: rgba(255,255,255,0.2);"></div>
                <div class="stat-item"><h4>‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°</h4><span id="liveCount" class="val" style="color: #ffeb3b;">0</span></div>
            </div>
            <div class="progress-line"><div id="fillBar"></div></div>
            <div id="counterStatus" style="font-size: 11px; text-align: center; margin-top: 6px;">‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§</div>
        </div>

        <div class="magic-tools">
            <label style="font-size: 12px; font-weight: bold;">üé≤ ‡¶Ö‡¶ü‡ßã ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü‡¶∞</label>
            <div style="display: flex; gap: 5px; margin-top: 5px;">
                <input type="number" id="randomCount" placeholder="‡¶ï‡¶Ø‡¶º‡¶ü‡¶ø?" style="width: 70px; padding: 5px;">
                <button onclick="autoSelectRandom()" style="flex:1; background:#673ab7; color:white; border:none; border-radius:4px; cursor:pointer;">‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡ßã</button>
            </div>
            <button onclick="shuffleSelectedQuestions()" style="width:100%; margin-top:5px; background:#ff9800; color:white; border:none; border-radius:4px; padding:8px; cursor:pointer; font-weight:bold;">üîÄ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶â‡¶≤‡¶ü-‡¶™‡¶æ‡¶≤‡¶ü ‡¶ï‡¶∞‡ßã</button>
        </div>

        <div id="filterGroup" style="background: #f0f0f0; padding: 10px; border-radius: 5px; margin-bottom: 10px; border:1px solid #ddd;">
            <div class="admin-only restriction-box">
                <h4>üîí ‡¶∏‡¶æ‡¶¨‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶ï‡¶∂‡¶®</h4>
                <input type="text" id="lockBox" placeholder="‡¶â‡¶¶‡¶æ: ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ, ‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø" oninput="saveData(); updateSubFilter()" class="input-group" style="margin-bottom:0;">
                <small style="font-size:10px; color:#666;">‡¶ï‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º‡¶ó‡ßÅ‡¶≤‡ßã ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®</small>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 5px;">
                <select id="fClass" onchange="renderSelectionList()" style="padding:8px; border-radius:4px;">
                    <option value="">‡¶∏‡¶¨ ‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø</option>
                    <option value="HSC">HSC</option>
                    <option value="‡¶¶‡¶∂‡¶Æ">‡¶¶‡¶∂‡¶Æ</option>
                    <option value="‡¶®‡¶¨‡¶Æ">‡¶®‡¶¨‡¶Æ</option>
                    <option value="‡¶Ö‡¶∑‡ßç‡¶ü‡¶Æ">‡¶Ö‡¶∑‡ßç‡¶ü‡¶Æ</option>
                    <option value="‡¶∏‡¶™‡ßç‡¶§‡¶Æ">‡¶∏‡¶™‡ßç‡¶§‡¶Æ</option>
                    <option value="‡¶∑‡¶∑‡ßç‡¶†">‡¶∑‡¶∑‡ßç‡¶†</option>
                    <option value="‡¶™‡¶û‡ßç‡¶ö‡¶Æ">‡¶™‡¶û‡ßç‡¶ö‡¶Æ</option>
                    <option value="‡¶ö‡¶§‡ßÅ‡¶∞‡ßç‡¶•">‡¶ö‡¶§‡ßÅ‡¶∞‡ßç‡¶•</option>
                    <option value="‡¶§‡ßÉ‡¶§‡ßÄ‡ßü">‡¶§‡ßÉ‡¶§‡ßÄ‡ßü</option>
                    <option value="‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡ßü">‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡ßü</option>
                    <option value="‡¶™‡ßç‡¶∞‡¶•‡¶Æ">‡¶™‡ßç‡¶∞‡¶•‡¶Æ</option>
                </select>
                <select id="fDiv" onchange="renderSelectionList()" style="padding:8px; border-radius:4px;">
                    <option value="">‡¶∏‡¶¨ ‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó</option>
                    <option value="‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£">‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£</option>
                    <option value="‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®</option>
                    <option value="‡¶Æ‡¶æ‡¶®‡¶¨‡¶ø‡¶ï">‡¶Æ‡¶æ‡¶®‡¶¨‡¶ø‡¶ï</option>
                    <option value="‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡¶Ø‡¶º ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ">‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡¶Ø‡¶º ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ</option>
                </select>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-bottom: 5px;">
                <select id="fSub" onchange="updateChapterFilter(); renderSelectionList()" style="padding:8px; border-radius:4px;"></select>
                <select id="fChap" onchange="renderSelectionList()" style="padding:8px; border-radius:4px;">
                    <option value="">‡¶∏‡¶¨ ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º</option>
                </select>
            </div>
            
            <select id="fType" onchange="renderSelectionList()" style="width:100%; padding:8px; border-radius:4px;">
                <option value="">‡¶∏‡¶¨ ‡¶ß‡¶∞‡¶®</option>
                <option value="normal">‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£</option>
                <option value="cq">‡¶∏‡ßÉ‡¶ú‡¶®‡¶∂‡ßÄ‡¶≤</option>
                <option value="mcq">MCQ</option>
            </select>
        </div>
        
        <!-- Selection Questions List with Pagination -->
        <div id="selectionList"></div>
        
        <!-- Selection Pagination Controls -->
        <div id="selectionPagination" class="selection-pagination" style="display: none;">
            <button onclick="changeSelectionPage(-1)" id="selectionPrevBtn">‚Üê ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞</button>
            <div class="selection-page-info" id="selectionPageInfo">‡¶™‡ßá‡¶ú 1/1</div>
            <button onclick="changeSelectionPage(1)" id="selectionNextBtn">‡¶™‡¶∞‡ßá‡¶∞ ‚Üí</button>
        </div>
        
        <button class="btn-action" style="background:#2e7d32; color:white; margin-top:15px;" onclick="window.print()">üñ®Ô∏è ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü / PDF</button>
    </div>

    <div id="bank" class="panel">
        <div class="admin-only">
            <h3>‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßã‡¶ó/‡¶è‡¶°‡¶ø‡¶ü</h3>
            <input type="hidden" id="editIndex" value="-1">
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                <select id="qClassInput" class="input-group" style="margin-bottom:0;">
                    <option value="">‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                    <option value="HSC">HSC</option>
                    <option value="‡¶¶‡¶∂‡¶Æ">‡¶¶‡¶∂‡¶Æ</option>
                    <option value="‡¶®‡¶¨‡¶Æ">‡¶®‡¶¨‡¶Æ</option>
                    <option value="‡¶Ö‡¶∑‡ßç‡¶ü‡¶Æ">‡¶Ö‡¶∑‡ßç‡¶ü‡¶Æ</option>
                    <option value="‡¶∏‡¶™‡ßç‡¶§‡¶Æ">‡¶∏‡¶™‡ßç‡¶§‡¶Æ</option>
                    <option value="‡¶∑‡¶∑‡ßç‡¶†">‡¶∑‡¶∑‡ßç‡¶†</option>
                    <option value="‡¶™‡¶û‡ßç‡¶ö‡¶Æ">‡¶™‡¶û‡ßç‡¶ö‡¶Æ</option>
                    <option value="‡¶ö‡¶§‡ßÅ‡¶∞‡ßç‡¶•">‡¶ö‡¶§‡ßÅ‡¶∞‡ßç‡¶•</option>
                    <option value="‡¶§‡ßÉ‡¶§‡ßÄ‡ßü">‡¶§‡ßÉ‡¶§‡ßÄ‡ßü</option>
                    <option value="‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡ßü">‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡ßü</option>
                    <option value="‡¶™‡ßç‡¶∞‡¶•‡¶Æ">‡¶™‡ßç‡¶∞‡¶•‡¶Æ</option>
                </select>
                <select id="qDivInput" class="input-group" style="margin-bottom:0;">
                    <option value="">‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                    <option value="‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£">‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£</option>
                    <option value="‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶®</option>
                    <option value="‡¶Æ‡¶æ‡¶®‡¶¨‡¶ø‡¶ï">‡¶Æ‡¶æ‡¶®‡¶¨‡¶ø‡¶ï</option>
                    <option value="‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡¶Ø‡¶º ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ">‡¶¨‡ßç‡¶Ø‡¶¨‡¶∏‡¶æ‡¶Ø‡¶º ‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ</option>
                </select>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <input type="text" id="qSub" placeholder="‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º" class="input-group">
                <input type="text" id="qChap" placeholder="‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º" class="input-group">
            </div>
            <select id="qType" onchange="toggleFields()" class="input-group">
                <option value="normal">‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£</option>
                <option value="cq">‡¶∏‡ßÉ‡¶ú‡¶®‡¶∂‡ßÄ‡¶≤</option>
                <option value="mcq">MCQ</option>
            </select>
            <label id="showOptionsLabel" style="display:none; align-items:center; cursor:pointer; font-weight:bold; margin-bottom:10px; font-size: 13px; color: var(--primary);">
                <input type="checkbox" id="showOptionsToggle" checked style="width:auto; margin-right:8px;"> ‡¶Ö‡¶™‡¶∂‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
            </label>
            <textarea id="qBody" rows="3" placeholder="‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®..." class="input-group"></textarea>
            <input type="text" id="qAns" placeholder="‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞" class="input-group">
            <input type="text" id="qBoard" placeholder="‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶ì ‡¶∏‡¶æ‡¶≤" class="input-group">
            <div id="extraFields" style="display:none; background:#f5f5f5; padding:10px; border-radius:5px; margin-bottom:10px;">
                <input type="text" id="qA" placeholder="‡¶ï" class="input-group">
                <input type="text" id="qB" placeholder="‡¶ñ" class="input-group">
                <input type="text" id="qC" placeholder="‡¶ó" class="input-group">
                <input type="text" id="qD" placeholder="‡¶ò" class="input-group">
            </div>
            <input type="file" id="qImg" accept="image/*" class="input-group" onchange="handleImage(event)">
            <div id="imgPreview" style="margin: 5px 0;"></div>
            <button class="btn-action" id="saveBtn" style="background:var(--primary); color:white;" onclick="addQuestion()">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <button class="btn-action" style="background:#777; color:white; display:none;" id="cancelBtn" onclick="cancelEdit()">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
        </div>
        <div class="admin-hide-msg" style="text-align:center; color:#999; margin-top:30px;"><p>‚ö†Ô∏è ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®‡•§</p></div>
    </div>

    <div id="sets" class="panel">
        <div style="background: #fff8e1; padding: 10px; border-radius: 5px; margin-bottom: 15px; border: 1px solid #ffe082;">
            <label style="display:flex; align-items:center; cursor:pointer; font-weight:bold;">
                <input type="checkbox" id="showAnsKey" checked onchange="sync()" style="width:auto; margin-right:10px;"> 
                ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü‡ßá ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶™‡¶§‡ßç‡¶∞ ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®
            </label>
        </div>
        
        <h4 style="color:var(--primary); margin-top:0; border-bottom:1px solid #ddd;">‚öôÔ∏è ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h4>
        
        <div class="input-group">
            <label>‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü</label>
            <input type="text" id="hSet" placeholder="‡¶ï" oninput="sync()">
        </div>
        
        <div class="input-group">
            <label>‡¶≠‡¶æ‡¶∑‡¶æ</label>
            <select id="qLang" onchange="sync()">
                <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
                <option value="en">‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø</option>
            </select>
        </div>
        
        <div class="input-group">
            <label>‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
            <input type="text" id="h1" value="‡¶∂‡ßá‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶∏‡¶∞‡¶ï‡¶æ‡¶∞‡¶ø ‡¶Æ‡¶π‡¶ø‡¶≤‡¶æ ‡¶ï‡¶≤‡ßá‡¶ú" oninput="sync()">
            <div class="slider-container">
                <input type="range" id="fsH1" min="16" max="40" value="24" oninput="updateSliderValue('fsH1', this.value); sync()">
                <span class="slider-value" id="fsH1Value">24px</span>
            </div>
            <div class="slider-label">
                <span>‡¶õ‡ßã‡¶ü</span>
                <span>‡¶¨‡¶°‡¶º</span>
            </div>
        </div>
        
        <div class="input-group">
            <label>‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
            <input type="text" id="h2" value="‡¶¨‡¶æ‡¶∞‡ßç‡¶∑‡¶ø‡¶ï ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ-‡ß®‡ß¶‡ß®‡ß¨" oninput="sync()">
            <div class="slider-container">
                <input type="range" id="fsH2" min="14" max="30" value="19" oninput="updateSliderValue('fsH2', this.value); sync()">
                <span class="slider-value" id="fsH2Value">19px</span>
            </div>
            <div class="slider-label">
                <span>‡¶õ‡ßã‡¶ü</span>
                <span>‡¶¨‡¶°‡¶º</span>
            </div>
        </div>
  
        <div class="input-group">
            <label>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø (‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶≤‡¶æ‡¶á‡¶®)</label>
            <input type="text" id="hClass" placeholder="‡¶è‡¶ï‡¶æ‡¶¶‡¶∂ (‡¶Æ‡¶æ‡¶®‡¶¨‡¶ø‡¶ï)" oninput="sync()">
        </div>
        
        <div class="input-group">
            <label>‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º (‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶≤‡¶æ‡¶á‡¶®)</label>
            <input type="text" id="h3" oninput="sync()">
        </div>
        
        <div class="input-group">
            <label>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø ‡¶ì ‡¶¨‡¶ø‡¶∑‡ßü‡ßá‡¶∞ ‡¶∏‡¶æ‡¶á‡¶ú</label>
            <div class="slider-container">
                <input type="range" id="fsH3" min="12" max="22" value="15" oninput="updateSliderValue('fsH3', this.value); sync()">
                <span class="slider-value" id="fsH3Value">15px</span>
            </div>
            <div class="slider-label">
                <span>‡¶õ‡ßã‡¶ü</span>
                <span>‡¶¨‡¶°‡¶º</span>
            </div>
        </div>

        <div style="display: flex; gap: 5px;">
            <div class="input-group">
                <label>‡¶∏‡¶Æ‡¶Ø‡¶º</label>
                <input type="text" id="hTime" oninput="sync()">
            </div>
            <div class="input-group">
                <label>‡¶Æ‡¶æ‡¶®</label>
                <input type="text" id="hMarks" oninput="sync()">
            </div>
        </div>
        
        <div class="input-group">
            <label>‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶ø‡¶ï‡¶æ</label>
            <input type="text" id="hInst" oninput="sync()">
            <div class="slider-container">
                <input type="range" id="fsH4" min="10" max="20" value="13" oninput="updateSliderValue('fsH4', this.value); sync()">
                <span class="slider-value" id="fsH4Value">13px</span>
            </div>
            <div class="slider-label">
                <span>‡¶õ‡ßã‡¶ü</span>
                <span>‡¶¨‡¶°‡¶º</span>
            </div>
        </div>
        
        <!-- Pagination Settings -->
        <div class="pagination-settings">
            <h4 style="color:var(--primary); margin-top:0; margin-bottom:10px;">üìÑ ‡¶™‡ßá‡¶ú‡¶ø‡¶®‡ßá‡¶∂‡¶® ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h4>
            <div class="input-group">
                <label>‡¶¨‡¶æ‡¶õ‡¶æ‡¶á‡¶§‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶™‡ßá‡¶ú‡ßá ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</label>
                <input type="number" id="selectionPerPage" value="10" min="1" max="50" oninput="saveData(); renderSelectionList()">
            </div>
            <div class="input-group">
                <label>‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶™‡ßá‡¶ú‡ßá ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®</label>
                <input type="number" id="outputPerPage" value="30" min="15" max="60" oninput="saveData(); renderOutputPages()">
            </div>
            <div style="background: #e8f5e9; padding: 10px; border-radius: 5px; margin-top: 10px;">
                <label style="font-weight: bold; color: #2e7d32; display: block; margin-bottom: 5px;">
                    üìÑ ‡¶Ö‡¶™‡¶ü‡¶ø‡¶Æ‡¶æ‡¶á‡¶ú‡¶° ‡¶≤‡ßá‡¶Ü‡¶â‡¶ü: <span class="page-status-indicator">‡ß©‡ß¶ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®/‡¶™‡ßá‡¶ú</span>
                </label>
                <small style="color:#666; display:block;">‡¶è‡¶ï ‡¶™‡ßá‡¶ú‡ßá ‡ß©‡ß¶‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶´‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶™‡¶ü‡¶ø‡¶Æ‡¶æ‡¶á‡¶ú‡¶°‡•§</small>
                <small style="color:#666; display:block;">‡ß®‡ßü ‡¶™‡¶æ‡¶§‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá ‡¶®‡¶æ</small>
            </div>
            <label style="display:flex; align-items:center; cursor:pointer; font-weight:bold; margin-top:10px; font-size:13px;">
                <input type="checkbox" id="showPageNumbers" checked onchange="saveData(); renderOutputPages()" style="width:auto; margin-right:8px;"> 
                ‡¶™‡ßá‡¶ú ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
            </label>
            <label style="display:flex; align-items:center; cursor:pointer; font-weight:bold; margin-top:10px; font-size:13px;">
                <input type="checkbox" id="showOutputPagination" checked onchange="toggleOutputPagination()" style="width:auto; margin-right:8px;"> 
                ‡¶Ü‡¶â‡¶ü‡¶™‡ßÅ‡¶ü ‡¶™‡ßá‡¶ú‡¶ø‡¶®‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®
            </label>
        </div>
        
        <div class="input-group">
            <label style="color: blue;">‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶ó‡ßç‡¶Ø‡¶æ‡¶™ (Spacing)</label>
            <div class="slider-container">
                <input type="range" id="qGapSlider" min="0" max="50" value="12" oninput="updateSliderValue('qGapSlider', this.value + 'px'); sync()">
                <span class="slider-value" id="qGapSliderValue">12px</span>
            </div>
            <div class="slider-label">
                <span>‡¶∏‡¶Ç‡¶ï‡ßÄ‡¶∞‡ßç‡¶£</span>
                <span>‡¶´‡¶æ‡¶Å‡¶ï‡¶æ</span>
            </div>
        </div>        
        
        <div class="input-group">
            <label>‡¶´‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶á‡¶ú</label>
            <div class="slider-container">
                <input type="range" id="fSize" min="10" max="20" value="13" oninput="updateSliderValue('fSize', this.value + 'px'); sync()">
                <span class="slider-value" id="fSizeValue">13px</span>
            </div>
            <div class="slider-label">
                <span>‡¶õ‡ßã‡¶ü</span>
                <span>‡¶¨‡¶°‡¶º</span>
            </div>
        </div>
        
        <div class="input-group">
            <label>‡¶≤‡¶æ‡¶á‡¶® ‡¶∏‡ßç‡¶™‡ßá‡¶∏‡¶ø‡¶Ç</label>
            <div class="slider-container">
                <input type="range" id="lHeight" min="1.0" max="2.5" step="0.1" value="1.3" oninput="updateSliderValue('lHeight', this.value); sync()">
                <span class="slider-value" id="lHeightValue">1.3</span>
            </div>
            <div class="slider-label">
                <span>‡¶∏‡¶Ç‡¶ï‡ßÄ‡¶∞‡ßç‡¶£</span>
                <span>‡¶´‡¶æ‡¶Å‡¶ï‡¶æ</span>
            </div>
        </div>
        
        <div class="input-group">
            <label>‡¶ï‡¶≤‡¶æ‡¶Æ</label>
            <select id="colCount" onchange="sync()">
                <option value="2">‡ß® ‡¶ï‡¶≤‡¶æ‡¶Æ</option>
                <option value="1">‡ßß ‡¶ï‡¶≤‡¶æ‡¶Æ</option>
            </select>
        </div>
        
        <h4 style="color:var(--primary); margin-top:20px; border-bottom:1px solid #ddd;">üìê ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡¶ø‡¶® ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏</h4>
        
        <div class="input-group">
            <label>‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡¶ø‡¶®</label>
            <div class="slider-container">
                <input type="range" id="mTop" min="5" max="30" value="12" oninput="updateSliderValue('mTop', this.value + 'mm'); sync()">
                <span class="slider-value" id="mTopValue">12mm</span>
            </div>
            <div class="slider-label">
                <span>‡¶õ‡ßã‡¶ü</span>
                <span>‡¶¨‡¶°‡¶º</span>
            </div>
        </div>
        
        <div class="input-group">
            <label>‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡¶ø‡¶®</label>
            <div class="slider-container">
                <input type="range" id="mBottom" min="5" max="30" value="12" oninput="updateSliderValue('mBottom', this.value + 'mm'); sync()">
                <span class="slider-value" id="mBottomValue">12mm</span>
            </div>
            <div class="slider-label">
                <span>‡¶õ‡ßã‡¶ü</span>
                <span>‡¶¨‡¶°‡¶º</span>
            </div>
        </div>
        
        <div class="input-group">
            <label>‡¶¨‡¶æ‡¶Æ ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡¶ø‡¶®</label>
            <div class="slider-container">
                <input type="range" id="mLeft" min="5" max="30" value="15" oninput="updateSliderValue('mLeft', this.value + 'mm'); sync()">
                <span class="slider-value" id="mLeftValue">15mm</span>
            </div>
            <div class="slider-label">
                <span>‡¶õ‡ßã‡¶ü</span>
                <span>‡¶¨‡¶°‡¶º</span>
            </div>
        </div>
        
        <div class="input-group">
            <label>‡¶°‡¶æ‡¶® ‡¶Æ‡¶æ‡¶∞‡ßç‡¶ú‡¶ø‡¶®</label>
            <div class="slider-container">
                <input type="range" id="mRight" min="5" max="30" value="15" oninput="updateSliderValue('mRight', this.value + 'mm'); sync()">
                <span class="slider-value" id="mRightValue">15mm</span>
            </div>
            <div class="slider-label">
                <span>‡¶õ‡ßã‡¶ü</span>
                <span>‡¶¨‡¶°‡¶º</span>
            </div>
        </div>
        
        <button class="btn-action" style="background:#555; color:white; margin-top:20px;" onclick="exportJSON()">üì• ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶Ü‡¶™</button>
        <button class="btn-action" style="background:#00796b; color:white;" onclick="document.getElementById('importFile').click()">üì§ ‡¶∞‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞</button>
        <input type="file" id="importFile" style="display:none;" onchange="importJSON(event)">
    </div>
</div>

<div class="preview-area" id="previewArea">
    <div id="examPaper" class="exam-paper">
        <!-- Output Pages Container -->
        <div id="outputPagesContainer"></div>
        
        <!-- Answer Sheet -->
        <div id="ansSheetArea"><h3 style="text-align:center; border-bottom: 1px solid #000; margin-bottom:10px; font-size: 16px;">‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶Æ‡¶æ‡¶≤‡¶æ</h3><div id="ansGrid" class="ans-grid"></div></div>
    </div>
</div>

<!-- Output Pagination Controls -->
<div id="outputPagination" class="output-pagination">
    <div style="display: flex; align-items: center; gap: 15px;">
        <button class="page-btn" onclick="changeOutputPage(-1)" id="outputPrevBtn">‚Üê ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞ ‡¶™‡ßá‡¶ú</button>
        <div class="page-info" id="outputPageInfo">‡¶™‡ßá‡¶ú 1/1</div>
        <button class="page-btn" onclick="changeOutputPage(1)" id="outputNextBtn">‡¶™‡¶∞‡ßá‡¶∞ ‡¶™‡ßá‡¶ú ‚Üí</button>
    </div>
    <div class="page-input-group">
        <span>‡¶Ø‡¶æ‡¶®:</span>
        <input type="number" id="jumpToOutputPage" min="1" value="1" onchange="jumpToOutputPage()">
        <span>/<span id="totalOutputPagesDisplay">1</span></span>
    </div>
</div>

<script>
    let questionBank = [];
    const DB_KEY = 'bcti_v25_final';
    let currentImgData = "", cropper;
    const MASTER_KEY = "BCTI-2026-PRO";
    
    // Pagination Variables
    let selectionCurrentPage = 1;
    let outputCurrentPage = 1;
    let selectionPerPage = 10;
    let outputPerPage = 30; // ‡ß©‡ß¶‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶™‡ßá‡¶ú
    let totalSelectionPages = 1;
    let totalOutputPages = 1;

    function checkLicense() { 
        const savedKey = localStorage.getItem('bcti_app_license'); 
        if (savedKey !== MASTER_KEY) { 
            const userInput = prompt("License Key:"); 
            if (userInput === MASTER_KEY) { localStorage.setItem('bcti_app_license', userInput); loadData(); } 
            else { document.body.innerHTML = `<h1>Invalid Access</h1>`; } 
        } else { loadData(); } 
    }
    
    function updateCounter() {
        const selected = questionBank.filter(q => q.selected).length;
        const target = parseInt(document.getElementById('targetCount').value) || 0;
        document.getElementById('liveCount').innerText = selected;
        let percent = target > 0 ? (selected / target) * 100 : 0;
        const bar = document.getElementById('fillBar');
        const status = document.getElementById('counterStatus');
        bar.style.width = (percent > 100 ? 100 : percent) + "%";
        if(selected < target) { status.innerText = `‡¶Ü‡¶∞‡¶ì ${target - selected}‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá`; bar.style.background = "#ffeb3b"; } 
        else if(selected == target) { status.innerText = "‚úÖ ‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!"; bar.style.background = "#4caf50"; } 
        else { status.innerText = `‚ö†Ô∏è ${selected - target}‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶¨‡ßá‡¶∂‡¶ø!`; bar.style.background = "#f44336"; }
    }

    function renderSelectionList() {
        // ‚úÖ ‡¶¨‡¶æ‡¶Æ ‡¶è‡¶≤‡¶æ‡¶á‡¶®‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶´‡ßã‡¶∞‡ßç‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶®
        document.getElementById('selectionList').style.textAlign = 'left';
        
        const isAdmin = document.getElementById('adminToggle').checked;
        const subF = document.getElementById('fSub').value;
        const classF = document.getElementById('fClass').value;
        const divF = document.getElementById('fDiv').value;
        const typeF = document.getElementById('fType').value;
        const chapF = document.getElementById('fChap').value;
        
        let filtered = questionBank.map((q, i) => ({...q, originalIndex: i})).filter(q => {
            return (!subF || q.sub === subF) && 
                   (!classF || q.qClass === classF) && 
                   (!divF || q.qDiv === divF) && 
                   (!typeF || q.type === typeF) &&
                   (!chapF || q.chap === chapF);
        });
        
        // ‚úÖ ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶ó‡ßç‡¶∞‡ßÅ‡¶™‡¶ø‡¶Ç
        const chapterGroups = {};
        filtered.forEach(q => {
            const chapter = q.chap || '‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü‡¶π‡ßÄ‡¶®';
            if (!chapterGroups[chapter]) {
                chapterGroups[chapter] = [];
            }
            chapterGroups[chapter].push(q);
        });
        
        // Selection Pagination
        selectionPerPage = parseInt(document.getElementById('selectionPerPage').value) || 10;
        totalSelectionPages = Math.ceil(filtered.length / selectionPerPage);
        if (totalSelectionPages < 1) totalSelectionPages = 1;
        if (selectionCurrentPage > totalSelectionPages) selectionCurrentPage = totalSelectionPages;
        
        const startIndex = (selectionCurrentPage - 1) * selectionPerPage;
        const endIndex = startIndex + selectionPerPage;
        const pagedQuestions = filtered.slice(startIndex, endIndex);
        
        // ‚úÖ ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶æ‡¶∞
        const chapterCounters = {};
        
        let outputHTML = '';
        let currentChapter = null;
        
        pagedQuestions.forEach((q, localIndex) => {
            const chapter = q.chap || '‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü‡¶π‡ßÄ‡¶®';
            
            // ‚úÖ ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶≤‡ßá ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
            if (chapter !== currentChapter) {
                currentChapter = chapter;
                
                // ‡¶è‡¶á ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü‡ßá ‡¶Æ‡ßã‡¶ü ‡¶ï‡¶§ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ü‡¶õ‡ßá
                const totalInChapter = filtered.filter(item => item.chap === chapter).length;
                
                outputHTML += `
                    <div class="chapter-header">
                        <div style="text-align: left;">
                            <strong>üìö ${chapter}</strong>
                            <small style="display: block;">‡¶Æ‡ßã‡¶ü ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®: ${totalInChapter}‡¶ü‡¶ø</small>
                        </div>
                        <div style="text-align: left;">
                            <small>${q.sub} | ${q.type === 'cq' ? '‡¶∏‡ßÉ‡¶ú‡¶®‡¶∂‡ßÄ‡¶≤' : q.type === 'mcq' ? 'MCQ' : '‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£'}</small>
                        </div>
                    </div>
                `;
            }
            
            // ‚úÖ ‡¶è‡¶á ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡ßü‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶á‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            chapterCounters[chapter] = (chapterCounters[chapter] || 0) + 1;
            const chapterSerialNumber = chapterCounters[chapter];
            
            let optHtml = "";
            if (q.type !== 'normal') {
                optHtml = `
                    <div class="q-card-options">
                        <div style="text-align: left;"><b>‡¶ï:</b> ${q.a || '-'}</div>
                        <div style="text-align: left;"><b>‡¶ñ:</b> ${q.b || '-'}</div>
                        <div style="text-align: left;"><b>‡¶ó:</b> ${q.c || '-'}</div>
                        <div style="text-align: left;"><b>‡¶ò:</b> ${q.d || '-'}</div>
                    </div>`;
            }
            
            outputHTML += `
            <div class="q-card" onclick="toggleQ(${q.originalIndex})" style="border-left: ${q.selected ? '6px solid var(--primary)' : '1px solid #eee'}">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px; text-align: left;">
                    <div class="chapter-serial-circle">
                        ${chapterSerialNumber}
                    </div>
                    <div style="text-align: left;">
                        <small style="font-size: 11px; color: #666;">
                            ${q.sub} | ${q.qClass || ''} | ${q.board || ''}
                        </small>
                    </div>
                </div>
                
                <div class="q-card-body" style="text-align: left;">
                    <b>${chapterSerialNumber}.</b> ${q.body}
                </div>
                ${optHtml}
                
                <div style="margin-top:10px; display: ${isAdmin ? 'flex' : 'none'}; gap: 5px; text-align: left;">
                    <button class="btn-mini" style="background:#1976d2; flex:1;" onclick="editQuestion(${q.originalIndex}, event)">üìù Edit</button>
                    <button class="btn-mini" style="background:#d32f2f; flex:1;" onclick="deleteQuestion(${q.originalIndex}, event)">üóëÔ∏è Delete</button>
                </div>
            </div>`;
        });
        
        // ‚úÖ ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá
        if (outputHTML === '') {
            outputHTML = '<p style="text-align:center; color:#666; padding:20px;">‡¶ï‡ßã‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§</p>';
        }
        
        document.getElementById('selectionList').innerHTML = outputHTML;
        
        // Update Selection Pagination Controls
        updateSelectionPagination();
        
        sync();
        renderOutputPages();
        updateCounter();
    }

    function updateSelectionPagination() {
        const paginationDiv = document.getElementById('selectionPagination');
        if (totalSelectionPages > 1) {
            paginationDiv.style.display = 'flex';
        } else {
            paginationDiv.style.display = 'none';
        }
        
        document.getElementById('selectionPageInfo').innerText = `‡¶™‡ßá‡¶ú ${selectionCurrentPage}/${totalSelectionPages}`;
        document.getElementById('selectionPrevBtn').disabled = selectionCurrentPage === 1;
        document.getElementById('selectionNextBtn').disabled = selectionCurrentPage === totalSelectionPages;
    }

    function changeSelectionPage(delta) {
        selectionCurrentPage += delta;
        if (selectionCurrentPage < 1) selectionCurrentPage = 1;
        if (selectionCurrentPage > totalSelectionPages) selectionCurrentPage = totalSelectionPages;
        
        renderSelectionList();
    }

    function toggleQ(i) { 
        questionBank[i].selected = !questionBank[i].selected; 
        saveData(); 
        renderSelectionList();
    }

    function renderOutputPages() {
        const selected = questionBank.filter(q => q.selected);
        const showPageNumbers = document.getElementById('showPageNumbers').checked;
        
        // Clear previous pages
        document.getElementById('outputPagesContainer').innerHTML = '';
        
        // If no questions, show empty page
        if (selected.length === 0) {
            totalOutputPages = 1;
            outputCurrentPage = 1;
            
            let pageHeader = `
            <div id="outSetLine"></div>
            <div class="header"><h1 id="outH1"></h1><h2 id="outH2"></h2></div>
            <div id="outClassLine" class="header-info"></div>
            <div id="outSubjectLine" class="header-info" style="margin-bottom:10px;"></div>
            <div class="marks-info"><span id="outTime"></span><span id="outMarks"></span></div>
            <div id="outInst" class="instruction"></div>`;
            
            let pageFooter = '';
            if (showPageNumbers) {
                pageFooter = `<div class="page-number">‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ 1/1</div>`;
            }
            
            document.getElementById('outputPagesContainer').innerHTML = `
            <div id="output-page-1" class="output-page active">
                ${pageHeader}
                <div class="question-container" style="column-count: ${document.getElementById('colCount').value}; text-align: center; padding: 50px;">
                    <p style="font-size: 18px; color: #666;">‡¶ï‡ßã‡¶® ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶¨‡¶æ‡¶Æ ‡¶™‡¶æ‡¶∂ ‡¶•‡ßá‡¶ï‡ßá ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                </div>
                ${pageFooter}
            </div>`;
            
            // Update header elements
            updateHeaders();
            updateOutputPagination();
            return;
        }
        
        // Get output per page setting (30 questions per page)
        outputPerPage = parseInt(document.getElementById('outputPerPage').value) || 30;
        // Ensure minimum 15 and maximum 60
        if (outputPerPage < 15) outputPerPage = 15;
        if (outputPerPage > 60) outputPerPage = 60;
        
        // Calculate number of pages needed based on questions
        totalOutputPages = Math.ceil(selected.length / outputPerPage);
        if (totalOutputPages < 1) totalOutputPages = 1;
        
        // Create pages
        let pagesHTML = '';
        
        for (let pageNum = 1; pageNum <= totalOutputPages; pageNum++) {
            const startIdx = (pageNum - 1) * outputPerPage;
            const endIdx = Math.min(startIdx + outputPerPage, selected.length);
            const pageQuestions = selected.slice(startIdx, endIdx);
            
            // Page header content - ONLY FOR FIRST PAGE
            let pageHeader = '';
            if (pageNum === 1) {
                // First page: full header
                pageHeader = `
                <div id="outSetLine"></div>
                <div class="header"><h1 id="outH1"></h1><h2 id="outH2"></h2></div>
                <div id="outClassLine" class="header-info"></div>
                <div id="outSubjectLine" class="header-info" style="margin-bottom:8px;"></div>
                <div class="marks-info"><span id="outTime"></span><span id="outMarks"></span></div>
                <div id="outInst" class="instruction"></div>`;
            } else {
                // Second page and beyond: NO HEADER, just page number
                pageHeader = '';
            }
            
            let pageContent = pageQuestions.map((q, i) => {
                const num = formatNum(startIdx + i + 1);
                const img = q.img ? `<img src="${q.img}" style="max-width:100%; display:block; margin:5px auto; max-height: 100px;">` : '';
                const isEnglish = q.sub.toLowerCase().includes("english") || q.sub.includes("‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø");
                const labels = isEnglish ? ["a", "b", "c", "d"] : ["‡¶ï", "‡¶ñ", "‡¶ó", "‡¶ò"];
                
                // Show full question text (no truncation)
                const formattedBody = q.body.replace(/\n/g, '<br>');

                let opt = "";
                if (q.type !== 'normal' && q.showOptions !== false) {
                    // Show full options (no truncation)
                    if (q.type === 'cq') opt = `
                        <div style="margin-top:4px; margin-left: 18px;">
                            <div class="sub-q"><span>${labels[0]}. ${q.a || ''}</span><span>‡ßß</span></div>
                            <div class="sub-q"><span>${labels[1]}. ${q.b || ''}</span><span>‡ß®</span></div>
                            <div class="sub-q"><span>${labels[2]}. ${q.c || ''}</span><span>‡ß©</span></div>
                            <div class="sub-q"><span>${labels[3]}. ${q.d || ''}</span><span>‡ß™</span></div>
                        </div>`;
                    else opt = `<div class="mcq-grid"><span>${labels[0]}. ${q.a || ''}</span><span>${labels[1]}. ${q.b || ''}</span><span>${labels[2]}. ${q.c || ''}</span><span>${labels[3]}. ${q.d || ''}</span></div>`;
                }
                
                return `
                <div class="${q.type==='cq'?'cq-box':'normal-q'}" style="font-size: ${document.getElementById('fSize').value}px !important; line-height: ${document.getElementById('lHeight').value} !important; margin-bottom: ${document.getElementById('qGapSlider').value}px !important;">
                    <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                        <div style="display:flex; gap:4px;"><b style="font-size: ${document.getElementById('fSize').value}px !important;">${num}.</b> <div style="font-size: ${document.getElementById('fSize').value}px !important; flex: 1;">${formattedBody}</div></div>
                    </div>
                    ${img}${opt}
                </div>`;
            }).join('');
            
            // Page footer with page number
            let pageFooter = '';
            if (showPageNumbers) {
                pageFooter = `<div class="page-number" style="font-size: 12px !important;">‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ${pageNum}/${totalOutputPages}</div>`;
            }
            
            // ‚úÖ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®: ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶á‡¶®‡¶æ‡¶∞‡ßá margin-top ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
            pagesHTML += `
            <div id="output-page-${pageNum}" class="output-page ${pageNum === outputCurrentPage ? 'active' : ''}" style="font-size: ${document.getElementById('fSize').value}px !important;">
                ${pageHeader}
                <div class="question-container" style="
                    column-count: ${document.getElementById('colCount').value}; 
                    font-size: ${document.getElementById('fSize').value}px !important; 
                    line-height: ${document.getElementById('lHeight').value} !important; 
                    column-gap: 35px;
                    margin-top: 15px; /* ‚úÖ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ó‡ßÅ‡¶≤‡ßã ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶®‡¶ø‡¶ö‡ßá ‡¶®‡¶æ‡¶Æ‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá */
                ">
                    ${pageContent}
                </div>
                ${pageFooter}
                ${pageNum < totalOutputPages ? '<div class="print-page-break" style="font-size: 12px !important;">--- ‡¶™‡ßá‡¶ú ‡¶¨‡ßç‡¶∞‡ßá‡¶ï ---</div>' : ''}
            </div>`;
        }
        
        document.getElementById('outputPagesContainer').innerHTML = pagesHTML;
        
        // Update answer grid with all questions
        document.getElementById('ansGrid').innerHTML = selected.map((q, i) => 
            `<div class="ans-box" style="font-size: ${document.getElementById('fSize').value}px !important;"><b>${formatNum(i+1)}.</b> ${q.ans || '...'}</div>`
        ).join('');
        
        // Update main header elements for first page
        updateHeaders();
        
        // Apply styling
        applyPageStyling();
        
        updateOutputPagination();
    }

    function applyPageStyling() {
        // Apply margins
        document.getElementById('examPaper').style.padding = `${document.getElementById('mTop').value}mm ${document.getElementById('mRight').value}mm ${document.getElementById('mBottom').value}mm ${document.getElementById('mLeft').value}mm`;
    }

    function updateHeaders() {
        document.getElementById('outH1').innerText = document.getElementById('h1').value;
        document.getElementById('outH2').innerText = document.getElementById('h2').value;
        document.getElementById('outClassLine').innerText = document.getElementById('hClass').value ? "‡¶∂‡ßç‡¶∞‡ßá‡¶£‡¶ø: " + document.getElementById('hClass').value : "";
        document.getElementById('outSubjectLine').innerText = document.getElementById('h3').value ? "‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º: " + document.getElementById('h3').value : "";
        document.getElementById('outTime').innerText = document.getElementById('hTime').value ? "‡¶∏‡¶Æ‡¶Ø‡¶º: " + document.getElementById('hTime').value : "";
        document.getElementById('outMarks').innerText = document.getElementById('hMarks').value ? "‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡¶Æ‡¶æ‡¶®: " + document.getElementById('hMarks').value : "";
        document.getElementById('outInst').innerText = document.getElementById('hInst').value;
        const setVal = document.getElementById('hSet').value, outSet = document.getElementById('outSetLine');
        if(setVal) { outSet.innerText = "‡¶∏‡ßá‡¶ü: " + setVal; outSet.style.display = "block"; } else { outSet.style.display = "none"; }
        document.getElementById('outH1').style.fontSize = document.getElementById('fsH1').value + "px";
        document.getElementById('outH2').style.fontSize = document.getElementById('fsH2').value + "px";
        document.getElementById('outClassLine').style.fontSize = document.getElementById('fsH3').value + "px";
        document.getElementById('outSubjectLine').style.fontSize = document.getElementById('fsH3').value + "px";
        document.getElementById('outInst').style.fontSize = document.getElementById('fsH4').value + "px";
    }

    function updateSliderValue(sliderId, value) {
        const valueElement = document.getElementById(sliderId + 'Value');
        if (valueElement) {
            valueElement.textContent = value;
        }
    }

    function updateOutputPagination() {
        const selected = questionBank.filter(q => q.selected).length;
        totalOutputPages = Math.max(1, totalOutputPages);
        
        document.getElementById('outputPageInfo').innerText = `‡¶™‡ßá‡¶ú ${outputCurrentPage}/${totalOutputPages}`;
        document.getElementById('totalOutputPagesDisplay').innerText = totalOutputPages;
        document.getElementById('jumpToOutputPage').value = outputCurrentPage;
        document.getElementById('jumpToOutputPage').max = totalOutputPages;
        
        document.getElementById('outputPrevBtn').disabled = outputCurrentPage === 1;
        document.getElementById('outputNextBtn').disabled = outputCurrentPage === totalOutputPages;
        
        toggleOutputPagination();
    }

    function changeOutputPage(delta) {
        const newPage = outputCurrentPage + delta;
        if (newPage < 1 || newPage > totalOutputPages) return;
        
        document.querySelectorAll('.output-page').forEach(page => {
            page.classList.remove('active');
        });
        
        outputCurrentPage = newPage;
        document.getElementById(`output-page-${outputCurrentPage}`).classList.add('active');
        
        updateOutputPagination();
        document.querySelector('.preview-area').scrollTop = 0;
    }

    function jumpToOutputPage() {
        const pageInput = document.getElementById('jumpToOutputPage');
        let pageNum = parseInt(pageInput.value);
        
        if (isNaN(pageNum) || pageNum < 1) pageNum = 1;
        if (pageNum > totalOutputPages) pageNum = totalOutputPages;
        
        document.querySelectorAll('.output-page').forEach(page => {
            page.classList.remove('active');
        });
        
        outputCurrentPage = pageNum;
        document.getElementById(`output-page-${outputCurrentPage}`).classList.add('active');
        
        updateOutputPagination();
        document.querySelector('.preview-area').scrollTop = 0;
    }

    function toggleOutputPagination() {
        const showPagination = document.getElementById('showOutputPagination').checked;
        const selected = questionBank.filter(q => q.selected).length;
        
        if (showPagination && totalOutputPages > 1) {
            document.getElementById('outputPagination').style.display = 'flex';
        } else {
            document.getElementById('outputPagination').style.display = 'none';
        }
    }

    function addQuestion() {
        const editIdx = parseInt(document.getElementById('editIndex').value);
        const q = { 
            sub: document.getElementById('qSub').value, 
            qClass: document.getElementById('qClassInput').value,
            qDiv: document.getElementById('qDivInput').value,
            chap: document.getElementById('qChap').value, 
            type: document.getElementById('qType').value, 
            body: document.getElementById('qBody').value, 
            ans: document.getElementById('qAns').value, 
            board: document.getElementById('qBoard').value, 
            a: document.getElementById('qA').value, 
            b: document.getElementById('qB').value, 
            c: document.getElementById('qC').value, 
            d: document.getElementById('qD').value, 
            img: currentImgData, 
            selected: false,
            showOptions: document.getElementById('showOptionsToggle').checked
        };
        
        if(editIdx > -1) { 
            q.selected = questionBank[editIdx].selected;
            questionBank[editIdx] = q; 
            cancelEdit(); 
        } else { 
            questionBank.push(q); 
        }
        
        saveData(); 
        updateSubFilter(); 
        updateChapterFilter(); 
        selectionCurrentPage = 1;
        renderSelectionList(); 
        alert("‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
    }

    function editQuestion(idx, e) {
        e.stopPropagation();
        const q = questionBank[idx];
        document.getElementById('editIndex').value = idx;
        document.getElementById('qSub').value = q.sub;
        document.getElementById('qClassInput').value = q.qClass || "";
        document.getElementById('qDivInput').value = q.qDiv || "";
        document.getElementById('qChap').value = q.chap || "";
        document.getElementById('qType').value = q.type;
        document.getElementById('qBody').value = q.body;
        document.getElementById('qA').value = q.a || "";
        document.getElementById('qB').value = q.b || "";
        document.getElementById('qC').value = q.c || "";
        document.getElementById('qD').value = q.d || "";
        document.getElementById('qAns').value = q.ans || "";
        document.getElementById('qBoard').value = q.board || "";
        document.getElementById('showOptionsToggle').checked = q.showOptions !== false;
        currentImgData = q.img || "";
        document.getElementById('imgPreview').innerHTML = currentImgData ? `<img src="${currentImgData}" style="width:100px;">` : "";
        
        toggleFields();
        document.getElementById('saveBtn').innerText = "‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®";
        document.getElementById('cancelBtn').style.display = "block";
        openTab('bank');
    }

    function deleteQuestion(idx, e) {
        e.stopPropagation();
        if(confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶≠‡¶æ‡¶¨‡ßá ‡¶è‡¶á ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶ü‡¶ø ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?")) {
            questionBank.splice(idx, 1);
            saveData(); 
            updateSubFilter(); 
            updateChapterFilter(); 
            selectionCurrentPage = 1;
            renderSelectionList();
        }
    }

    function cancelEdit() {
        document.getElementById('editIndex').value = "-1";
        document.getElementById('saveBtn').innerText = "‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®";
        document.getElementById('cancelBtn').style.display = "none";
        document.querySelectorAll('#bank input, #bank textarea, #bank select').forEach(i => i.value = "");
        document.getElementById('imgPreview').innerHTML = "";
        currentImgData = "";
    }

    function sync() {
        document.getElementById('examPaper').style.padding = `${document.getElementById('mTop').value}mm ${document.getElementById('mRight').value}mm ${document.getElementById('mBottom').value}mm ${document.getElementById('mLeft').value}mm`;
        document.getElementById('ansSheetArea').style.display = document.getElementById('showAnsKey').checked ? "block" : "none";
        
        renderOutputPages();
        saveData();
    }

    function updateSubFilter() {
        const fSub = document.getElementById('fSub');
        const lockText = document.getElementById('lockBox').value.trim();
        const isAdmin = document.getElementById('adminToggle').checked;
        let subs = [...new Set(questionBank.map(q => q.sub))];
        if (lockText !== "" && !isAdmin) {
            let allowed = lockText.split(',').map(s => s.trim().toLowerCase());
            subs = subs.filter(s => allowed.includes(s.toLowerCase()));
        }
        fSub.innerHTML = '<option value="">‡¶∏‡¶¨ ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º</option>' + subs.map(s => `<option value="${s}">${s}</option>`).join('');
    }

    function updateChapterFilter() {
        const subF = document.getElementById('fSub').value;
        const fChap = document.getElementById('fChap');
        let chapters = [];
        if(subF) {
            chapters = [...new Set(questionBank.filter(q => q.sub === subF).map(q => q.chap))];
        } else {
            chapters = [...new Set(questionBank.map(q => q.chap))];
        }
        fChap.innerHTML = '<option value="">‡¶∏‡¶¨ ‡¶Ö‡¶ß‡ßç‡¶Ø‡¶æ‡¶Ø‡¶º</option>' + chapters.filter(c => c).map(c => `<option value="${c}">${c}</option>`).join('');
    }

    function toggleAdmin() {
        const cb = document.getElementById('adminToggle');
        if (cb.checked) { 
            if (prompt("‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°:") === "1234") { 
                document.getElementById('sidebarMain').classList.add('admin-active'); 
                document.getElementById('currentModeDisplay').innerText = "‡¶è‡¶°‡¶Æ‡¶ø‡¶®"; 
            } else cb.checked = false; 
        }
        else { 
            document.getElementById('sidebarMain').classList.remove('admin-active'); 
            document.getElementById('currentModeDisplay').innerText = "‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£"; 
        }
        updateSubFilter(); 
        renderSelectionList();
    }

    function saveData() {
        const d = { 
            sets: [document.getElementById('h1').value, document.getElementById('h2').value, document.getElementById('hClass').value, document.getElementById('h3').value, document.getElementById('hTime').value, document.getElementById('hMarks').value, document.getElementById('hInst').value, document.getElementById('targetCount').value, document.getElementById('hSet').value],
            hSizes: [document.getElementById('fsH1').value, document.getElementById('fsH2').value, document.getElementById('fsH3').value, document.getElementById('fsH4').value],
            margins: [document.getElementById('mTop').value, document.getElementById('mBottom').value, document.getElementById('mLeft').value, document.getElementById('mRight').value],
            fSize: document.getElementById('fSize').value, 
            lHeight: document.getElementById('lHeight').value, 
            cols: document.getElementById('colCount').value, 
            lang: document.getElementById('qLang').value, 
            qs: questionBank,
            restrictedList: document.getElementById('lockBox').value,
            // Pagination settings
            selectionPerPage: document.getElementById('selectionPerPage').value,
            outputPerPage: document.getElementById('outputPerPage').value,
            showPageNumbers: document.getElementById('showPageNumbers').checked,
            showOutputPagination: document.getElementById('showOutputPagination').checked,
            // Question gap
            qGap: document.getElementById('qGapSlider').value
        };
        localStorage.setItem(DB_KEY, JSON.stringify(d));
    }

    function loadData() {
        const d = JSON.parse(localStorage.getItem(DB_KEY) || '{}');
        if(d.qs) {
            document.getElementById('h1').value = d.sets[0] || "‡¶∂‡ßá‡¶∞‡¶ñ‡¶æ‡¶≤‡ßÄ ‡¶∏‡¶∞‡¶ï‡¶æ‡¶∞‡¶ø ‡¶Æ‡¶π‡¶ø‡¶≤‡¶æ ‡¶ï‡¶≤‡ßá‡¶ú"; 
            document.getElementById('h2').value = d.sets[1] || "‡¶¨‡¶æ‡¶∞‡ßç‡¶∑‡¶ø‡¶ï ‡¶™‡¶∞‡ßÄ‡¶ï‡ßç‡¶∑‡¶æ-‡ß®‡ß¶‡ß®‡ß¨"; 
            document.getElementById('hClass').value = d.sets[2] || "";
            document.getElementById('h3').value = d.sets[3] || "";
            document.getElementById('targetCount').value = d.sets[7] || 10; 
            document.getElementById('hSet').value = d.sets[8] || "";
            document.getElementById('fsH1').value = d.hSizes[0] || 24; 
            document.getElementById('fsH2').value = d.hSizes[1] || 19;
            document.getElementById('lockBox').value = d.restrictedList || "";
            questionBank = d.qs;
            
            // Load pagination settings
            if (d.selectionPerPage) {
                document.getElementById('selectionPerPage').value = d.selectionPerPage;
            }
            if (d.outputPerPage) {
                document.getElementById('outputPerPage').value = d.outputPerPage;
            }
            if (d.showPageNumbers !== undefined) {
                document.getElementById('showPageNumbers').checked = d.showPageNumbers;
            }
            if (d.showOutputPagination !== undefined) {
                document.getElementById('showOutputPagination').checked = d.showOutputPagination;
            }
            
            // Load question gap
            if (d.qGap) {
                document.getElementById('qGapSlider').value = d.qGap;
            }
            
            // Update slider values display
            updateSliderValue('fsH1', document.getElementById('fsH1').value + 'px');
            updateSliderValue('fsH2', document.getElementById('fsH2').value + 'px');
            updateSliderValue('fsH3', document.getElementById('fsH3').value + 'px');
            updateSliderValue('fsH4', document.getElementById('fsH4').value + 'px');
            updateSliderValue('qGapSlider', document.getElementById('qGapSlider').value + 'px');
            updateSliderValue('fSize', document.getElementById('fSize').value + 'px');
            updateSliderValue('lHeight', document.getElementById('lHeight').value);
            updateSliderValue('mTop', document.getElementById('mTop').value + 'mm');
            updateSliderValue('mBottom', document.getElementById('mBottom').value + 'mm');
            updateSliderValue('mLeft', document.getElementById('mLeft').value + 'mm');
            updateSliderValue('mRight', document.getElementById('mRight').value + 'mm');
        }
        updateSubFilter(); 
        updateChapterFilter(); 
        sync(); 
        renderSelectionList();
    }

    function formatNum(n) { 
        return document.getElementById('qLang').value === 'bn' ? 
            n.toString().split('').map(d => '‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ'[d] || d).join('') : n; 
    }
    
    function openTab(id) { 
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active')); 
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); 
        document.getElementById(id).classList.add('active'); 
        if(event) event.currentTarget.classList.add('active'); 
    }
    
    function toggleFields() { 
        const type = document.getElementById('qType').value; 
        document.getElementById('extraFields').style.display = (type === 'normal') ? 'none' : 'block'; 
        document.getElementById('showOptionsLabel').style.display = (type === 'normal') ? 'none' : 'flex'; 
    }
    
    function handleImage(e) { 
        const file = e.target.files[0]; 
        if (!file) return; 
        const reader = new FileReader(); 
        reader.onload = function(ev) { 
            document.getElementById('cropImage').src = ev.target.result; 
            document.getElementById('cropperModal').style.display = 'block'; 
            if (cropper) cropper.destroy(); 
            setTimeout(() => { 
                cropper = new Cropper(document.getElementById('cropImage'), { autoCropArea: 1, viewMode: 1 }); 
            }, 100); 
        }; 
        reader.readAsDataURL(file); 
    }
    
    function finishCrop() { 
        currentImgData = cropper.getCroppedCanvas({ maxWidth: 800 }).toDataURL('image/jpeg', 0.7); 
        document.getElementById('imgPreview').innerHTML = `<img src="${currentImgData}" style="width:100px;">`; 
        closeCropper(); 
    }
    
    function closeCropper() { 
        document.getElementById('cropperModal').style.display = 'none'; 
    }
    
    function autoSelectRandom() { 
        let count = parseInt(document.getElementById('randomCount').value);
        if(!count) return;
        let pool = questionBank.filter(q => !q.selected);
        for(let i=0; i<count && pool.length>0; i++){
            let rIdx = Math.floor(Math.random() * pool.length);
            pool[rIdx].selected = true;
            pool.splice(rIdx, 1);
        }
        saveData(); 
        renderSelectionList();
    }
    
    function shuffleSelectedQuestions() {
        let selected = questionBank.filter(q => q.selected);
        let others = questionBank.filter(q => !q.selected);
        for (let i = selected.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [selected[i], selected[j]] = [selected[j], selected[i]];
        }
        questionBank = [...selected, ...others];
        saveData(); 
        renderSelectionList();
    }
    
    function exportJSON() { 
        const a = document.createElement('a'); 
        a.href = URL.createObjectURL(new Blob([localStorage.getItem(DB_KEY)], {type: "application/json"})); 
        a.download = "BCTI_Backup.json"; 
        a.click(); 
    }
    
    function importJSON(e) { 
        const r = new FileReader(); 
        r.onload = (ev) => { 
            localStorage.setItem(DB_KEY, ev.target.result); 
            location.reload(); 
        }; 
        r.readAsText(e.target.files[0]); 
    }
</script>
</body>
</html>